"use strict";(self["webpackChunktoutiao_m"]=self["webpackChunktoutiao_m"]||[]).push([[491],{2491:function(t,e,s){s.r(e),s.d(e,{default:function(){return at}});var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"article-container"},[e("van-nav-bar",{staticClass:"page-nav-bar",attrs:{"left-arrow":"",title:"头条"},on:{"click-left":function(e){return t.$router.back()}}}),e("div",{staticClass:"main-wrap"},[t.loading?e("div",{staticClass:"loading-wrap"},[e("van-loading",{attrs:{color:"#3296fa",vertical:""}},[t._v("加载中")])],1):t.article.title?e("div",{staticClass:"article-detail"},[e("h1",{staticClass:"article-title"},[t._v(t._s(t.article.title))]),e("van-cell",{staticClass:"user-info",attrs:{center:"",border:!1}},[e("van-image",{staticClass:"avatar",attrs:{slot:"icon",round:"",fit:"cover",src:t.article.aut_photo},slot:"icon"}),e("div",{staticClass:"user-name",attrs:{slot:"title"},slot:"title"},[t._v(t._s("黑马程序员(改不了)"===t.article.aut_name?"善良的程序员作家":t.article.aut_name))]),e("div",{staticClass:"publish-date",attrs:{slot:"label"},slot:"label"},[t._v(t._s(t._f("relativeTime")(t.article.pubdate)))]),e("follow-user",{attrs:{is_followed:t.article.is_followed,aut_id:t.article.aut_id},on:{"update:is_followed":function(e){return t.$set(t.article,"is_followed",e)}}})],1),e("div",{ref:"articleContent",staticClass:"article-content markdown-body",domProps:{innerHTML:t._s(t.article.content)}}),e("van-divider",[t._v("正文结束")]),e("comment-list",{ref:"commentListRef",attrs:{source:t.articleId},on:{"onload-success":function(e){t.commentTotalCount=e}}}),e("van-popup",{attrs:{position:"bottom"},model:{value:t.isPostShow,callback:function(e){t.isPostShow=e},expression:"isPostShow"}},[e("comment-post",{attrs:{source:t.articleId},on:{"post-success":t.postSuccess}})],1)],1):404===t.errorCode?e("div",{staticClass:"error-wrap"},[e("van-icon",{attrs:{name:"failure"}}),e("p",{staticClass:"text"},[t._v("该资源不存在或已删除！")])],1):e("div",{staticClass:"error-wrap"},[e("van-icon",{attrs:{name:"failure"}}),e("p",{staticClass:"text"},[t._v("内容加载失败！")]),e("van-button",{staticClass:"retry-btn",on:{click:t.getArticleById}},[t._v("点击重试")])],1)]),t.isPostShow?t._e():e("div",{staticClass:"article-bottom"},[e("van-button",{staticClass:"comment-btn",attrs:{type:"default",round:"",size:"small"},on:{click:function(e){t.isPostShow=!0}}},[t._v("写评论")]),e("van-icon",{attrs:{name:"comment-o",badge:t.commentTotalCount,color:"#777"}}),e("collect-article",{attrs:{is_collected:t.article.is_collected,articleId:t.articleId},on:{"update:is_collected":function(e){return t.$set(t.article,"is_collected",e)}}}),e("like-article",{attrs:{attitude:t.article.attitude,articleId:t.articleId},on:{"update:attitude":function(e){return t.$set(t.article,"attitude",e)}}}),e("van-icon",{attrs:{name:"share",color:"#777777"}})],1)],1)},i=[],a=s(8572),n=s(6471),l=function(){var t=this,e=t._self._c;return t.is_followed?e("van-button",{staticClass:"follow-btn",attrs:{loading:t.followLoading,round:"",size:"small"},on:{click:t.onFollow}},[t._v("已关注")]):e("van-button",{staticClass:"follow-btn",attrs:{loading:t.followLoading,type:"info",color:"#3296fa",round:"",size:"small",icon:"plus"},on:{click:t.onFollow}},[t._v("关注")])},c=[],r=s(2900),u={props:{is_followed:{type:Boolean,required:!0},aut_id:{type:String,required:!0}},data(){return{followLoading:!1}},methods:{async onFollow(){this.followLoading=!0;try{this.is_followed?(await(0,r.VR)(this.aut_id),this.$emit("update:is_followed",!1)):(await(0,r.R3)(this.aut_id),this.$emit("update:is_followed",!0)),this.followLoading=!1}catch(t){t.response&&400===t.response.status?this.$toast("不能关注自己哦"):t.response&&401===t.response.status?this.$toast.fail("您还没有登录, 请登录后再试"):this.$toast.fail("操作失败, 请稍后重试"),this.followLoading=!1}}}},d=u,m=s(1001),h=(0,m.Z)(d,l,c,!1,null,null,null),p=h.exports,f=function(){var t=this,e=t._self._c;return t.is_collected?e("van-icon",{attrs:{color:"#fdcb15",name:"star"},on:{click:t.onCollect}}):e("van-icon",{attrs:{color:"#777",name:"star-o"},on:{click:t.onCollect}})},_=[],v={props:{is_collected:{type:Boolean,require:!0},articleId:{type:String,required:!0}},methods:{async onCollect(){this.$toast.loading({message:"加载中...",forbidClick:!0});try{this.is_collected?(await(0,a.qI)(this.articleId),this.$emit("update:is_collected",!1),this.$toast.success("已取消收藏")):(await(0,a._Y)(this.articleId),this.$emit("update:is_collected",!0),this.$toast.success("收藏成功"))}catch(t){t.response&&401===t.response.status?this.$toast.fail("您还没有登录, 请登录后再试"):this.$toast.fail("操作失败, 请重试")}}}},g=v,w=(0,m.Z)(g,f,_,!1,null,null,null),y=w.exports,b=function(){var t=this,e=t._self._c;return-1===t.attitude?e("van-icon",{attrs:{color:"#777",name:"good-job-o"},on:{click:t.onLike}}):e("van-icon",{attrs:{color:"red",name:"good-job"},on:{click:t.onLike}})},C=[],k={props:{attitude:{required:!0},articleId:{type:String,required:!0}},methods:{async onLike(){try{1===this.attitude?(await(0,a.Nk)(this.articleId),this.$emit("update:attitude",-1),this.$toast.success("已取消点赞")):(await(0,a.dE)(this.articleId),console.log(2),this.$emit("update:attitude",1),this.$toast.success("成功点赞"))}catch(t){t.response&&401===t.response.status?this.$toast.fail("您还没有登录, 请登录后再试"):this.$toast.fail("操作失败, 请稍后重试")}}}},$=k,S=(0,m.Z)($,b,C,!1,null,null,null),I=S.exports,x=function(){var t=this,e=t._self._c;return e("div",{staticClass:"comment-list"},[e("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了"},on:{load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.list,(function(s,o){return e("comment-item",{key:o,attrs:{comment:t.list[o]},on:{"update:comment":function(e){return t.$set(t.list,o,e)},"click-reply":t.clickReply}})})),1),e("van-popup",{staticStyle:{height:"94%"},attrs:{"get-container":"body",position:"bottom"},model:{value:t.isReplyShow,callback:function(e){t.isReplyShow=e},expression:"isReplyShow"}},[t.isReplyShow?e("comment-reply",{attrs:{comment:t.currentComment},on:{"click-close":t.clickClose}}):t._e()],1)],1)},L=[],Z=s(4471);function P(t){return(0,Z.Z)({url:"/v1_0/comments",params:t})}function R(t){return(0,Z.Z)({url:"/v1_0/comment/likings",method:"POST",data:{target:t}})}function q(t){return(0,Z.Z)({url:`/v1_0/comment/likings/${t}`,method:"delete"})}function T(t){return(0,Z.Z)({url:"/v1_0/comments",method:"post",data:t})}var M=function(){var t=this,e=t._self._c;return e("van-cell",{staticClass:"comment-item"},[e("van-image",{staticClass:"avatar",attrs:{slot:"icon",round:"",fit:"cover",src:t.comment.aut_photo},slot:"icon"}),e("div",{staticClass:"title-wrap",attrs:{slot:"title"},slot:"title"},[e("div",{staticClass:"user-name"},[t._v(t._s(t.comment.aut_name))]),e("van-button",{staticClass:"like-btn",attrs:{icon:t.comment.is_liking?"good-job":"good-job-o"},on:{click:t.onLike}},[t._v(t._s(t.comment.like_count||"赞"))])],1),e("div",{attrs:{slot:"label"},slot:"label"},[e("p",{staticClass:"comment-content"},[t._v(t._s(t.comment.content))]),e("div",{staticClass:"bottom-info"},[e("span",{staticClass:"comment-pubdate"},[t._v(t._s(t._f("relativeTime")(t.comment.pubdate)))]),e("van-button",{staticClass:"reply-btn",attrs:{round:""},on:{click:function(e){return t.$emit("click-reply",t.comment)}}},[t._v("回复 "+t._s(t.comment.reply_count))])],1)])],1)},j=[],A={name:"CommentItem",props:{comment:{type:Object,required:!0}},methods:{async onLike(){try{this.comment.is_liking?(await q(this.comment.com_id),this.$emit("update:comment",{...this.comment,is_liking:!1}),this.$toast.success("已取消点赞")):(await R(this.comment.com_id),this.$emit("update:comment",{...this.comment,is_liking:!0}),this.$toast.success("成功点赞"))}catch(t){t.response&&401===t.response.status?this.$toast.fail("先登录后点赞哦~"):this.$toast.fail("操作失败, 请重试")}}}},z=A,B=(0,m.Z)(z,M,j,!1,null,"02e2569a",null),N=B.exports,E=function(){var t=this,e=t._self._c;return e("div",{staticClass:"comment-reply"},[e("van-nav-bar",{staticClass:"nav-bar-reply",attrs:{title:`${t.comment.reply_count}条回复`}},[e("van-icon",{attrs:{slot:"left",name:"cross"},on:{click:function(e){return t.$emit("click-close")}},slot:"left"})],1),e("van-cell",{attrs:{title:"当前评论"}},[e("van-image",{staticStyle:{"margin-right":"10px"},attrs:{slot:"icon",round:"",width:"30",height:"30",src:t.comment.aut_photo},slot:"icon"}),e("span",{staticStyle:{color:"#466b9d"},attrs:{slot:"title"},slot:"title"},[t._v(t._s(t.comment.aut_name))]),e("div",{attrs:{slot:"label"},slot:"label"},[e("p",{staticStyle:{color:"#363636"}},[t._v(t._s(t.comment.content))]),e("p",[e("span",{staticStyle:{"margin-right":"10px"}},[t._v(t._s(t._f("relativeTime")(t.comment.pubdate)))]),e("van-button",{attrs:{size:"mini",type:"default"}},[t._v("回复 "+t._s(t.comment.reply_count))])],1)]),e("van-icon",{attrs:{slot:"right-icon"},slot:"right-icon"})],1),e("van-cell",{attrs:{title:"所有回复"}}),e("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了"},on:{load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.list,(function(t,s){return e("comment-item",{key:s,attrs:{comment:t}})})),1)],1)},F=[],O={name:"CommentReply",components:{commentItem:N},props:{comment:{type:Object,required:!0,isPostShow:!1}},data(){return{list:[],loading:!1,finished:!1,offset:null,limit:20}},methods:{async onLoad(){const{data:t}=await P({type:"c",source:this.comment.com_id.toString(),offset:this.offset,limit:this.limit}),{results:e}=t;this.list.push(...e),this.loading=!1,e.length?this.offset=t.last_id:this.finished=!0}}},V=O,Y=(0,m.Z)(V,E,F,!1,null,"49db2360",null),H=Y.exports,U={components:{commentItem:N,commentReply:H},data(){return{list:[],loading:!1,finished:!1,offset:null,limit:10,isReplyShow:!1,currentComment:{}}},props:{source:{type:String,required:!0}},created(){this.onLoad()},methods:{async onLoad(){try{const{data:t}=await P({type:"a",source:this.source,offset:this.offset,limit:this.limit}),e=t.results;this.list.push(...e),this.$emit("onload-success",t.total_count),this.loading=!1,e.length>0?this.offset=t.last_id:this.finished=!0}catch(t){console.log(t)}},clickReply(t){console.log(t),this.currentComment=t,this.isReplyShow=!0},clickClose(){this.isReplyShow=!1}}},D=U,G=(0,m.Z)(D,x,L,!1,null,"7a065080",null),J=G.exports,K=function(){var t=this,e=t._self._c;return e("div",{staticClass:"comment-post"},[e("van-field",{staticClass:"post-field",attrs:{rows:"2",autosize:"",type:"textarea",maxlength:"50",placeholder:"请输入留言","show-word-limit":""},model:{value:t.postMessage,callback:function(e){t.postMessage=e},expression:"postMessage"}}),e("van-button",{staticClass:"post-btn",on:{click:t.onPost}},[t._v("发布")])],1)},Q=[],W={name:"CommentPost",data(){return{postMessage:""}},props:{source:{type:[Number,String],required:!0}},methods:{async onPost(){if(this.postMessage){this.$toast.loading({duration:0,message:"发布中...",forbidClick:!0});try{const{data:t}=await T({target:this.source,content:this.postMessage,art_id:null});this.$emit("post-success",t.new_obj),this.$toast.success("评论成功"),this.postMessage=""}catch(t){t.response&&401===t.response.status?this.$toast.fail("登录后才能评论哦"):this.$toast.fail("操作失败, 请重试")}}}}},X=W,tt=(0,m.Z)(X,K,Q,!1,null,"361b2560",null),et=tt.exports,st={name:"ArticleIndex",components:{followUser:p,collectArticle:y,likeArticle:I,commentList:J,commentPost:et},props:{articleId:{type:[Number,String],required:!0}},data(){return{article:{},loading:!1,errorCode:0,commentTotalCount:0,isPostShow:!1}},created(){this.getArticleById(this.articleId)},methods:{async getArticleById(t){this.loading=!0;try{const{data:e}=await(0,a.Vr)(t);this.article={...e},setTimeout((()=>{this.previewImage()}),0)}catch(e){e.response&&404===e.response.status&&(this.errorCode=404)}this.loading=!1},previewImage(){const t=this.$refs.articleContent,e=t.querySelectorAll("img"),s=[];e.forEach(((t,e)=>{s.push(t.src),t.oncLick=()=>{(0,n.Z)({images:s,startPosition:e,closeable:!0})}}))},postSuccess(t){this.isPostShow=!1,this.$refs.commentListRef.list.unshift(t)}}},ot=st,it=(0,m.Z)(ot,o,i,!1,null,"b8f01508",null),at=it.exports},8572:function(t,e,s){s.d(e,{Nk:function(){return r},Vr:function(){return a},Zz:function(){return i},_Y:function(){return n},dE:function(){return c},qI:function(){return l}});var o=s(4471);function i(t){return(0,o.Z)({url:"/v1_0/articles",params:t})}function a(t){return(0,o.Z)({url:`/v1_0/articles/${t}`})}function n(t){return(0,o.Z)({url:"/v1_0/article/collections",method:"post",data:{target:t}})}function l(t){return(0,o.Z)({url:`/v1_0/article/collections/${t}`,method:"delete"})}function c(t){return(0,o.Z)({url:"/v1_0/article/likings",method:"post",data:{target:t}})}function r(t){return(0,o.Z)({url:`/v1_0/article/likings/${t}`,method:"delete"})}}}]);
//# sourceMappingURL=491.1817286e.js.map