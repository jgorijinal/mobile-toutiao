"use strict";(self["webpackChunktoutiao_m"]=self["webpackChunktoutiao_m"]||[]).push([[946],{5946:function(t,e,n){n.r(e),n.d(e,{default:function(){return O}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"home-container"},[e("van-nav-bar",{attrs:{fixed:""},scopedSlots:t._u([{key:"title",fn:function(){return[e("van-button",{staticClass:"search-btn",attrs:{to:"/search",icon:"search",type:"info",round:"",size:"small"}},[t._v("搜索")])]},proxy:!0}])}),e("van-tabs",{staticClass:"channel-tabs",attrs:{animated:"",swipeable:""},scopedSlots:t._u([{key:"nav-right",fn:function(){return[e("van-icon",{staticClass:"hamburg",attrs:{name:"wap-nav"},on:{click:function(e){t.isEditChannelShow=!0}}}),e("div",{staticClass:"placeholder"})]},proxy:!0}]),model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},t._l(t.channels,(function(t){return e("van-tab",{key:t.id,attrs:{title:t.name}},[e("article-list",{attrs:{channel:t}})],1)})),1),e("van-popup",{style:{height:"80%"},attrs:{closeable:"","close-icon-position":"top-left",position:"bottom"},model:{value:t.isEditChannelShow,callback:function(e){t.isEditChannelShow=e},expression:"isEditChannelShow"}},[e("channel-edit",{attrs:{"my-channels":t.channels,"active-index":t.active},on:{"update:myChannels":function(e){t.channels=e},"update:my-channels":function(e){t.channels=e},"update-active":t.updateActive}})],1)],1)},i=[],a=n(2900),r=function(){var t=this,e=t._self._c;return e("div",{staticClass:"article-list"},[e("van-pull-refresh",{attrs:{"success-text":t.refreshSuccessText,"success-duration":1500},on:{refresh:t.onRefresh},model:{value:t.isRefreshLoading,callback:function(e){t.isRefreshLoading=e},expression:"isRefreshLoading"}},[e("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了",error:t.error,"error-text":"请求失败，点击重新加载"},on:{load:t.onLoad,"update:error":function(e){t.error=e}},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.list,(function(t,n){return e("article-item",{key:n,attrs:{article:t}})})),1)],1)],1)},l=[],c=n(8572),o=function(){var t=this,e=t._self._c;return e("van-cell",{staticClass:"article-item",attrs:{to:{name:"article",params:{articleId:t.article.art_id}}},scopedSlots:t._u([{key:"title",fn:function(){return[e("span",{staticClass:"title van-multi-ellipsis--l2"},[t._v(t._s(t.article.title))])]},proxy:!0},{key:"label",fn:function(){return[3===t.article.cover.type?e("div",{staticClass:"cover-wrap"},t._l(t.article.cover.images,(function(t,n){return e("div",{key:n,staticClass:"cover-item"},[e("van-image",{staticClass:"cover-item-image",attrs:{fit:"cover",src:t}})],1)})),0):t._e(),e("div",{staticClass:"label-info-wrap"},[e("span",[t._v(t._s("黑马程序员(改不了)"===t.article.aut_name?"善良的程序员作家":t.article.aut_name))]),e("span",[t._v(t._s(t.article.comm_count+"评论"))]),e("span",[t._v(t._s(t._f("relativeTime")(t.article.pubdate)))])])]},proxy:!0}])},[1===t.article.cover.type?e("van-image",{staticClass:"right-cover",attrs:{fit:"cover",src:t.article.cover.images[0]}}):t._e()],1)},u=[],h={name:"ArticleItem",props:{article:{type:Object,required:!0}}},d=h,f=n(1001),m=(0,f.Z)(d,o,u,!1,null,"bda6dda4",null),v=m.exports,p={name:"ArticleList",components:{ArticleItem:v},props:{channel:{type:Object,required:!0}},data(){return{list:[],loading:!1,finished:!1,timestamp:null,error:!1,isRefreshLoading:!1,refreshSuccessText:""}},methods:{async onLoad(){try{const{data:t}=await(0,c.Zz)({channel_id:this.channel.id,timestamp:this.timestamp||Date.now()}),e=t.results;this.list.push(...e),this.loading=!1,e.length?this.timestamp=t.pre_timestamp:this.finished=!0}catch(t){this.error=!0,this.loading=!1}},async onRefresh(){try{const{data:t}=await(0,c.Zz)({channel_id:this.channel.id,timestamp:Date.now()}),e=t.results;this.list.unshift(...e),this.isRefreshLoading=!1,this.refreshSuccessText=`刷新成功, 已成功更新${e.length}条数据`}catch(t){this.refreshSuccessText="刷新失败, 请再刷新一次",this.isRefreshLoading=!1}}}},C=p,_=(0,f.Z)(C,r,l,!1,null,"6921b7de",null),y=_.exports,g=function(){var t=this,e=t._self._c;return e("div",{staticClass:"channel-edit"},[e("van-cell",{attrs:{border:!1},scopedSlots:t._u([{key:"title",fn:function(){return[e("span",{staticClass:"title-text"},[t._v("我的频道")])]},proxy:!0}])},[e("van-button",{staticClass:"edit-btn",attrs:{size:"mini",type:"danger",plain:"",round:""},on:{click:function(e){t.isEdit=!t.isEdit}}},[t._v(t._s(t.isEdit?"完成":"编辑"))])],1),e("van-grid",{staticClass:"my-grid",attrs:{gutter:"10"}},t._l(t.myChannels,(function(n,s){return e("van-grid-item",{key:n.id,staticClass:"grid-item",class:{active:t.activeIndex===s,isEdit:t.isEdit&&!t.fixeChannels.includes(n.id)},attrs:{text:n.name,icon:t.isEdit&&!t.fixeChannels.includes(n.id)?"close":""},on:{click:function(e){return t.clickMyChannel(n,s)}}})})),1),e("van-cell",{attrs:{border:!1},scopedSlots:t._u([{key:"title",fn:function(){return[e("span",{staticClass:"title-text"},[t._v("频道推荐")])]},proxy:!0}])}),e("van-grid",{staticClass:"recommend-grid",attrs:{gutter:"10"}},t._l(t.recommendChannels,(function(n){return e("van-grid-item",{key:n.id,staticClass:"grid-item",attrs:{icon:"plus",text:n.name},on:{click:function(e){return t.addChannel(n)}}})})),1)],1)},x=[],b=n(4471);function k(){return(0,b.Z)({url:"/v1_0/channels"})}function E(t){return(0,b.Z)({url:"/v1_0/user/channels",method:"patch",data:{channels:t}})}function w(t){return(0,b.Z)({url:`/v1_0/user/channels/${t}`,method:"DELETE"})}var Z=n(7247),S={props:{myChannels:{type:Array,required:!0},activeIndex:{type:Number,required:!0}},data(){return{allChannels:[],isEdit:!1,fixeChannels:[0]}},computed:{recommendChannels(){const t=this.allChannels.filter((t=>!this.myChannels.find((e=>e.id===t.id))));return t}},created(){this.getAllChannels()},methods:{async getAllChannels(){const{data:t}=await k();this.allChannels=t.channels},async addChannel(t){if(this.$emit("update:myChannels",[...this.myChannels,t]),this.$store.state.user.user)try{await E([{id:t.id,seq:this.myChannels.length}])}catch(e){this.$toast("保存失败, 请稍后重试")}else Z.Z.setItem("TOUTIAO_CHANNELS",[...this.myChannels,t])},async clickMyChannel(t,e){if(this.isEdit){let s;if(this.fixeChannels.includes(t.id)?this.$toast("不能删除此频道哦"):(s=[...this.myChannels],s.splice(e,1),this.$emit("update:myChannels",s),e<=this.activeIndex&&this.$emit("update-active",this.activeIndex-1,!0)),this.$store.state.user.user)try{await w(t.id)}catch(n){this.$toast("操作失败, 请稍后重试")}else Z.Z.setItem("TOUTIAO_CHANNELS",s)}else this.$emit("update-active",e,!1)}}},$=S,A=(0,f.Z)($,g,x,!1,null,"9f4c3be4",null),I=A.exports,L={components:{ArticleList:y,ChannelEdit:I},data(){return{active:0,channels:[],isEditChannelShow:!1}},created(){this.getUserChannels()},methods:{async getUserChannels(){try{if(this.$store.state.user.user){const{data:t}=await(0,a.vh)();this.channels=t.channels}else{const t=Z.Z.getItem("TOUTIAO_CHANNELS");if(t)this.channels=t;else{const{data:t}=await(0,a.vh)();this.channels=t.channels}}}catch(t){this.$toast("数据获取失败")}},updateActive(t,e=!1){this.active=t,this.isEditChannelShow=e}}},T=L,N=(0,f.Z)(T,s,i,!1,null,"31b41e65",null),O=N.exports},8572:function(t,e,n){n.d(e,{Nk:function(){return o},Vr:function(){return a},Zz:function(){return i},_Y:function(){return r},dE:function(){return c},qI:function(){return l}});var s=n(4471);function i(t){return(0,s.Z)({url:"/v1_0/articles",params:t})}function a(t){return(0,s.Z)({url:`/v1_0/articles/${t}`})}function r(t){return(0,s.Z)({url:"/v1_0/article/collections",method:"post",data:{target:t}})}function l(t){return(0,s.Z)({url:`/v1_0/article/collections/${t}`,method:"delete"})}function c(t){return(0,s.Z)({url:"/v1_0/article/likings",method:"post",data:{target:t}})}function o(t){return(0,s.Z)({url:`/v1_0/article/likings/${t}`,method:"delete"})}}}]);
//# sourceMappingURL=946.622d6578.js.map